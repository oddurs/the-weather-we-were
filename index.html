<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Weather We Were — An Indie Folk Ballad</title>
  <meta name="description" content="Listen to The Weather We Were — an indie folk ballad about love, loss, and the weather of memory. An immersive synced lyrics experience.">
  <meta name="theme-color" content="#f0ebe3">

  <!-- favicon -->
  <link rel="icon" href="favicon.ico" sizes="32x32">
  <link rel="icon" href="favicon-heart.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <!-- open graph -->
  <meta property="og:type" content="music.song">
  <meta property="og:title" content="The Weather We Were">
  <meta property="og:description" content="An indie folk ballad about love, loss, and the weather of memory. Synced lyrics experience.">
  <meta property="og:image" content="https://oddurs.github.io/the-weather-we-were/og-image.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="1200">

  <!-- twitter card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="The Weather We Were">
  <meta name="twitter:description" content="An indie folk ballad about love, loss, and the weather of memory.">
  <meta name="twitter:image" content="https://oddurs.github.io/the-weather-we-were/og-image.jpg">

  <!-- structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "MusicRecording",
    "name": "The Weather We Were",
    "genre": "Indie Folk",
    "description": "An indie folk ballad about love, loss, and the weather of memory",
    "duration": "PT4M10S"
  }
  </script>

  <!-- preload critical assets -->
  <link rel="preload" href="cover-680.jpg" as="image">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Sorts+Mill+Goudy:ital@0;1&family=Lato:ital,wght@0,300;0,400;1,300&display=swap');

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --paper: #f0ebe3;
      --paper-deep: #e6dfd4;
      --ink: #2c2622;
      --ink-light: #4a433d;
      --muted: #a09588;
      --rose: #b5706e;
      --rose-light: #c9918f;
      --blue: #6a8a9e;
      --blue-deep: #4e6f84;
      --gold: #b39660;
      --gold-light: #c9ae7e;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--paper);
      color: var(--ink);
      font-family: 'Sorts Mill Goudy', 'Georgia', serif;
      font-weight: 400;
      line-height: 1.7;
      display: flex;
      flex-direction: column;
    }

    /* ---- ambient canvas ---- */
    #ambientCanvas {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    /* ---- paper texture ---- */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      opacity: .04;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.65' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
      background-size: 200px;
      pointer-events: none;
      z-index: 1;
    }

    /* ======== INTRO PANEL ======== */
    .intro-panel {
      position: fixed;
      inset: 0;
      z-index: 5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
      /* return transition: slide back in, delayed so lyrics fade out first */
      transition: transform .8s cubic-bezier(.4,0,.2,1) .5s, opacity .8s ease .5s;
    }

    body.playing .intro-panel {
      transform: translateY(-100%);
      opacity: 0;
      pointer-events: none;
      /* exit transition: slide out immediately */
      transition: transform .8s cubic-bezier(.4,0,.2,1), opacity .8s ease;
    }

    .intro-title {
      font-family: 'Sorts Mill Goudy', serif;
      font-weight: 400;
      font-size: clamp(2.4rem, 6vw, 3.8rem);
      line-height: 1.1;
      letter-spacing: .02em;
      color: var(--ink);
      text-align: center;
    }

    .intro-title em {
      font-style: italic;
      font-weight: 400;
      color: var(--rose);
    }

    .intro-panel .subtitle {
      font-size: 1.05rem;
      margin-bottom: 2.5rem;
    }

    .intro-panel .album-cover {
      width: clamp(200px, 40vw, 320px);
      height: clamp(200px, 40vw, 320px);
    }

    .intro-panel .idle-text {
      font-family: 'Lato', sans-serif;
      font-weight: 300;
      font-size: .5rem;
      letter-spacing: .3em;
      text-transform: uppercase;
      color: var(--muted);
      margin-top: 1.2rem;
      animation: breathe 3s ease-in-out infinite;
    }

    /* ======== SHARED: Album Cover ======== */
    .album-cover {
      position: relative;
      width: clamp(180px, 36vw, 280px);
      height: clamp(180px, 36vw, 280px);
      border-radius: 6px;
      overflow: hidden;
      cursor: pointer;
      box-shadow:
        0 4px 30px rgba(44,38,34,.15),
        0 0 0 1px rgba(44,38,34,.06);
      transition: transform .3s ease, box-shadow .3s ease;
    }

    .album-cover:hover {
      transform: scale(1.02);
      box-shadow:
        0 8px 40px rgba(44,38,34,.2),
        0 0 0 1px rgba(44,38,34,.08);
    }

    .album-cover:active {
      transform: scale(.98);
    }

    .album-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .album-cover .cover-overlay {
      position: absolute;
      inset: 0;
      background: rgba(44,38,34,.2);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background .3s ease;
    }

    .album-cover:hover .cover-overlay {
      background: rgba(44,38,34,.3);
    }

    .album-cover .play-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 1.5px solid rgba(255,255,255,.7);
      background: rgba(255,255,255,.1);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform .2s, background .2s, border-color .2s;
    }

    .album-cover:hover .play-circle {
      transform: scale(1.06);
      background: rgba(255,255,255,.18);
      border-color: #fff;
    }

    .album-cover .play-circle svg {
      width: 20px;
      height: 20px;
      fill: #fff;
      margin-left: 2px;
      filter: drop-shadow(0 1px 3px rgba(0,0,0,.2));
    }

    @keyframes breathe {
      0%, 100% { opacity: .25; }
      50% { opacity: .6; }
    }

    /* ======== HEADER (lyrics view) ======== */
    .header {
      text-align: center;
      padding: 2rem 2rem .6rem;
      flex-shrink: 0;
      position: relative;
      z-index: 2;
      opacity: 0;
      transform: translateY(-20px);
      /* hide transition: no delay */
      transition: opacity .5s ease, transform .5s ease;
    }

    body.playing .header {
      opacity: 1;
      transform: translateY(0);
      /* show transition: delayed */
      transition: opacity .6s ease .3s, transform .6s ease .3s;
    }

    .genre {
      font-family: 'Lato', sans-serif;
      font-weight: 300;
      font-size: .5rem;
      letter-spacing: .35em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: .6rem;
    }

    h1 {
      font-family: 'Sorts Mill Goudy', serif;
      font-weight: 400;
      font-size: clamp(2rem, 5.5vw, 3.2rem);
      line-height: 1.1;
      letter-spacing: .02em;
      color: var(--ink);
    }

    h1 em {
      font-style: italic;
      font-weight: 400;
      color: var(--rose);
    }

    .subtitle {
      font-family: 'Sorts Mill Goudy', serif;
      font-style: italic;
      font-weight: 400;
      color: var(--muted);
      font-size: .95rem;
      margin-top: .2rem;
      letter-spacing: .03em;
    }

    /* ======== LYRICS PANE ======== */
    .lyrics-pane {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
      z-index: 2;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 91%, transparent 100%);
      -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 91%, transparent 100%);
      opacity: 0;
      transform: translateY(30px);
      /* hide transition: no delay */
      transition: opacity .6s ease, transform .6s ease;
    }

    .lyrics-pane::-webkit-scrollbar { display: none; }

    body.playing .lyrics-pane {
      opacity: 1;
      transform: translateY(0);
      /* show transition: delayed */
      transition: opacity .7s ease .4s, transform .7s ease .4s;
    }

    .lyrics {
      max-width: 760px;
      margin: 0 auto;
      padding: 2rem 2.5rem 6rem;
      text-align: center;
    }

    .lyrics section {
      margin-bottom: 2rem;
    }

    .lyrics .label {
      font-family: 'Lato', sans-serif;
      font-weight: 300;
      font-size: .45rem;
      letter-spacing: .35em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: .7rem;
      transition: opacity .5s ease;
    }

    /* ---- lyric lines ---- */
    .lyrics .lyric-line {
      font-family: 'Sorts Mill Goudy', serif;
      font-weight: 400;
      font-size: clamp(1.2rem, 2.6vw, 1.65rem);
      line-height: 2;
      color: var(--ink);
      cursor: pointer;
      transition: opacity .5s ease, transform .4s ease, color .5s ease, letter-spacing .4s ease, background .3s ease;
      padding: 1px 8px;
      letter-spacing: .02em;
      position: relative;
      border-radius: 4px;
    }

    /* hover underline (draws from center) */
    .lyrics .lyric-line::after {
      content: '';
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 1px;
      background: var(--rose-light);
      transition: width .3s ease;
      opacity: .6;
    }

    .lyrics .lyric-line:hover::after {
      width: 60%;
    }

    .lyrics .lyric-line:hover {
      color: var(--rose);
    }

    /* click pulse */
    .lyrics .lyric-line.lyric-click {
      animation: clickPulse .25s ease;
    }

    @keyframes clickPulse {
      50% { transform: scale(1.07); }
    }

    .divider {
      width: 40px;
      height: 0;
      border-top: 1px solid var(--gold-light);
      margin: 2.2rem auto;
      opacity: .3;
      transition: opacity .5s ease;
    }

    /* ======== SYNCED LYRICS MODE ======== */
    body.synced .lyrics .lyric-line {
      opacity: .1;
      transform: translateY(0) scale(1);
    }

    body.synced .lyrics .lyric-line.lyric-near-2 {
      opacity: .18;
    }

    body.synced .lyrics .lyric-line.lyric-near-1 {
      opacity: .35;
    }

    body.synced .lyrics .lyric-line.lyric-active {
      opacity: 1;
      transform: scale(1.04);
      color: var(--ink);
      background: linear-gradient(90deg, transparent 5%, rgba(181,112,110,.05) 30%, rgba(179,150,96,.05) 70%, transparent 95%);
    }

    body.synced .lyrics .lyric-line:hover {
      opacity: .4;
    }

    body.synced .lyrics .lyric-line.lyric-active:hover {
      opacity: 1;
    }

    body.synced .lyrics .label {
      opacity: .12;
    }

    body.synced .lyrics .label.label-active {
      opacity: .7;
    }

    body.synced .lyrics .divider {
      opacity: .08;
    }

    /* ======== PLAYER BAR (floating pill) ======== */
    .player-bar {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      opacity: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px 8px 8px;
      border-radius: 999px;
      background: rgba(240,235,227,.82);
      backdrop-filter: blur(20px) saturate(1.4);
      -webkit-backdrop-filter: blur(20px) saturate(1.4);
      border: 1px solid rgba(44,38,34,.06);
      box-shadow:
        0 4px 24px rgba(44,38,34,.07),
        0 0 0 1px rgba(44,38,34,.03),
        inset 0 1px 0 rgba(255,255,255,.4);
      pointer-events: none;
      width: clamp(320px, 94vw, 580px);
      /* hide transition: no delay */
      transition: transform .5s cubic-bezier(.4,0,.2,1), opacity .5s ease, box-shadow .3s ease, background .3s ease;
    }

    body.playing .player-bar {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
      pointer-events: auto;
      /* show transition: delayed */
      transition: transform .6s cubic-bezier(.4,0,.2,1) .5s, opacity .6s ease .5s, box-shadow .3s ease, background .3s ease;
    }

    .player-bar:hover {
      background: rgba(240,235,227,.92);
      box-shadow:
        0 6px 32px rgba(44,38,34,.1),
        0 0 0 1px rgba(44,38,34,.05),
        inset 0 1px 0 rgba(255,255,255,.5);
    }

    /* thumbnail */
    .bar-thumb {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
      border: 2px solid rgba(255,255,255,.5);
      box-shadow: 0 1px 4px rgba(44,38,34,.1);
    }

    /* control buttons */
    .player-bar .ctrl-btn {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background .2s, transform .12s;
    }

    .player-bar .ctrl-btn:hover {
      background: rgba(44,38,34,.08);
    }

    .player-bar .ctrl-btn:active { transform: scale(.9); }

    .player-bar .ctrl-btn svg {
      width: 14px;
      height: 14px;
      fill: var(--ink);
      transition: fill .2s;
    }

    /* play button: hero style */
    .player-bar .ctrl-btn.play-btn {
      width: 38px;
      height: 38px;
      background: var(--ink);
    }

    .player-bar .ctrl-btn.play-btn svg {
      fill: var(--paper);
      width: 15px;
      height: 15px;
    }

    .player-bar .ctrl-btn.play-btn:hover {
      background: var(--rose);
    }

    .player-bar .ctrl-btn.replay-btn svg {
      fill: var(--muted);
    }

    .player-bar .ctrl-btn.replay-btn:hover svg {
      fill: var(--ink);
    }

    /* volume group */
    .volume-group {
      display: flex;
      align-items: center;
      gap: 2px;
      flex-shrink: 0;
    }

    .volume-group .ctrl-btn svg {
      fill: var(--muted);
    }

    .volume-group .ctrl-btn:hover svg {
      fill: var(--ink);
    }

    .volume-slider {
      -webkit-appearance: none;
      appearance: none;
      width: 48px;
      height: 3px;
      border-radius: 3px;
      background: rgba(44,38,34,.1);
      outline: none;
      cursor: pointer;
      transition: height .15s;
    }

    .volume-slider:hover {
      height: 5px;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--muted);
      cursor: pointer;
      transition: background .2s;
    }

    .volume-slider:hover::-webkit-slider-thumb {
      background: var(--ink);
    }

    .volume-slider::-moz-range-thumb {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--muted);
      border: none;
      cursor: pointer;
    }

    .volume-slider::-moz-range-track {
      height: 3px;
      border-radius: 3px;
      background: rgba(44,38,34,.1);
    }

    /* progress group */
    .progress-group {
      flex: 1;
      display: flex;
      align-items: center;
      gap: .5rem;
      min-width: 0;
    }

    .progress-group .time {
      font-family: 'Lato', sans-serif;
      font-weight: 300;
      font-size: .6rem;
      color: var(--muted);
      font-variant-numeric: tabular-nums;
      flex-shrink: 0;
      width: 3em;
    }

    .progress-group .time.time-end {
      text-align: right;
    }

    .progress-wrap {
      flex: 1;
      height: 3px;
      background: rgba(44,38,34,.08);
      border-radius: 3px;
      cursor: pointer;
      position: relative;
      transition: height .15s;
    }

    .progress-wrap:hover {
      height: 5px;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: var(--rose);
      border-radius: 3px;
      transition: width .1s linear;
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      right: -1px;
      top: 50%;
      transform: translateY(-50%) scale(0);
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--rose);
      transition: transform .15s;
    }

    .progress-wrap:hover .progress-bar::after {
      transform: translateY(-50%) scale(1);
    }

    /* ---- reveal animation ---- */
    .reveal {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .7s ease, transform .7s ease;
    }

    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* ---- password gate ---- */
    .gate {
      position: fixed;
      inset: 0;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--paper);
      transition: opacity 1.2s ease, transform 1.2s cubic-bezier(.4,0,.2,1);
    }

    .gate.unlocked {
      opacity: 0;
      transform: scale(1.03);
      pointer-events: none;
    }

    .gate.unlocked .gate-input {
      color: var(--rose);
      border-color: transparent;
    }

    .gate-mark {
      width: 40px;
      height: 0;
      border-top: 1px solid var(--gold-light);
      margin-bottom: 2rem;
      opacity: .4;
    }

    .gate-input {
      font-family: 'Sorts Mill Goudy', serif;
      font-style: italic;
      font-size: 1.4rem;
      text-align: center;
      background: transparent;
      border: none;
      border-bottom: 1px solid rgba(44,38,34,.15);
      color: var(--ink);
      outline: none;
      padding: .5rem 1rem;
      width: 200px;
      letter-spacing: .08em;
      caret-color: var(--rose);
      transition: border-color .3s ease, color .4s ease;
    }

    .gate-input::placeholder {
      color: var(--muted);
      opacity: .4;
    }

    .gate-input:focus {
      border-bottom-color: var(--rose-light);
    }

    .gate-hint {
      font-family: 'Lato', sans-serif;
      font-weight: 300;
      font-size: .45rem;
      letter-spacing: .3em;
      text-transform: uppercase;
      color: var(--muted);
      margin-top: 1.2rem;
    }

    .gate-wrong {
      animation: shake .4s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      75% { transform: translateX(6px); }
    }

    /* ---- love screen ---- */
    .love-screen {
      position: fixed;
      inset: 0;
      z-index: 6;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(240,235,227,.97);
      opacity: 0;
      pointer-events: none;
      transition: opacity 2.5s ease;
      padding: 2rem;
    }

    .love-screen.visible {
      opacity: 1;
      pointer-events: auto;
    }

    /* staggered reveal for each child */
    .love-screen > * {
      opacity: 0;
      transform: translateY(12px);
      transition: opacity 2s ease, transform 2s ease;
    }

    .love-screen.visible > *:nth-child(1) { opacity: 1; transform: translateY(0); transition-delay: .5s; }
    .love-screen.visible > *:nth-child(2) { opacity: 1; transform: translateY(0); transition-delay: 2s; }
    .love-screen.visible > *:nth-child(3) { opacity: 1; transform: translateY(0); transition-delay: 4s; }
    .love-screen.visible > *:nth-child(4) { opacity: 1; transform: translateY(0); transition-delay: 7s; }

    .love-screen .love-heart svg {
      width: 28px;
      height: 28px;
    }

    .love-screen .love-opener {
      font-family: 'Sorts Mill Goudy', serif;
      font-style: italic;
      font-size: clamp(1.6rem, 4vw, 2.4rem);
      color: var(--ink);
      text-align: center;
      line-height: 1.6;
      letter-spacing: .02em;
      margin-top: 1.5rem;
    }

    .love-screen .love-body {
      font-family: 'Sorts Mill Goudy', serif;
      font-style: italic;
      font-size: clamp(1.05rem, 2.5vw, 1.35rem);
      color: var(--muted);
      text-align: center;
      line-height: 2;
      margin-top: 1.5rem;
      max-width: 400px;
    }

    .love-screen .love-close {
      margin-top: 2.5rem;
      text-align: center;
    }

    .love-screen .love-main {
      font-family: 'Sorts Mill Goudy', serif;
      font-style: italic;
      font-size: clamp(1.6rem, 4vw, 2.4rem);
      color: var(--rose);
      letter-spacing: .02em;
    }

    .love-screen .love-author {
      font-family: 'Sorts Mill Goudy', serif;
      font-style: italic;
      font-size: .95rem;
      color: var(--muted);
      margin-top: 1rem;
      letter-spacing: .06em;
      opacity: .7;
    }

    /* ---- responsive ---- */

    /* large screens: more immersive */
    @media (min-width: 1200px) {
      .lyrics .lyric-line {
        font-size: 1.8rem;
        line-height: 2.2;
      }
      .intro-title {
        font-size: 4.2rem;
      }
      .intro-panel .album-cover {
        width: 340px;
        height: 340px;
      }
      .intro-panel .subtitle {
        font-size: 1.15rem;
      }
    }

    /* tablet */
    @media (max-width: 768px) {
      .header {
        padding: 1.5rem 1.5rem .5rem;
      }
      .lyrics {
        padding: 1.5rem 1.5rem 6rem;
      }
      .intro-panel .album-cover {
        width: clamp(180px, 50vw, 280px);
        height: clamp(180px, 50vw, 280px);
      }
      .intro-panel .subtitle {
        margin-bottom: 2rem;
      }
    }

    /* mobile */
    @media (max-width: 480px) {
      .volume-group { display: none; }
      .header {
        padding: 1.2rem 1rem .4rem;
      }
      h1 {
        font-size: clamp(1.6rem, 7vw, 2.2rem);
      }
      .intro-title {
        font-size: clamp(2rem, 8vw, 2.8rem);
      }
      .intro-panel .subtitle {
        margin-bottom: 1.5rem;
        font-size: .9rem;
      }
      .lyrics {
        padding: 1rem 1rem 5rem;
      }
      .lyrics .lyric-line {
        font-size: clamp(1.05rem, 4.2vw, 1.4rem);
        line-height: 1.9;
      }
      .player-bar {
        bottom: 1rem;
        padding: 6px 10px 6px 6px;
        gap: 6px;
      }
      .bar-thumb {
        width: 34px;
        height: 34px;
      }
      .player-bar .ctrl-btn.play-btn {
        width: 34px;
        height: 34px;
      }
    }

    /* very small */
    @media (max-width: 380px) {
      .progress-group .time { display: none; }
      .intro-title {
        font-size: clamp(1.8rem, 9vw, 2.4rem);
      }
    }
  </style>
</head>
<body>

<!-- password gate -->
<div class="gate" id="gate">
  <div class="gate-mark"></div>
  <input type="text" class="gate-input" id="gateInput" autocomplete="off" autofocus spellcheck="false" placeholder="&bull;&bull;&bull;&bull;&bull;">
  <p class="gate-hint">enter to continue</p>
</div>

<audio id="audioEl" preload="metadata">
  <source src="song.ogg" type="audio/ogg; codecs=opus">
  <source src="song.mp3" type="audio/mpeg">
</audio>

<canvas id="ambientCanvas"></canvas>

<!-- intro panel -->
<div class="intro-panel" id="introPanel">
  <p class="genre">indie folk &middot; ballad</p>
  <div class="intro-title">The Weather <em>We Were</em></div>
  <p class="subtitle">Some loves don&rsquo;t end</p>
  <div class="album-cover" id="playHero" role="button" aria-label="Play" tabindex="0">
    <img src="cover-680.jpg" alt="The Weather We Were">
    <div class="cover-overlay">
      <div class="play-circle">
        <svg viewBox="0 0 24 24"><polygon points="7,3 21,12 7,21"/></svg>
      </div>
    </div>
  </div>
  <span class="idle-text">listen</span>
</div>

<!-- header (lyrics view) -->
<header class="header">
  <p class="genre">indie folk &middot; ballad</p>
  <h1>The Weather <em>We Were</em></h1>
  <p class="subtitle">Some loves don&rsquo;t end</p>
</header>

<!-- lyrics pane -->
<div class="lyrics-pane" id="lyricsPane">
  <main class="lyrics" id="lyricsMain">

    <section class="reveal" data-section="verse">
      <div class="label">Verse I</div>
      <p class="lyric-line" data-time="18.1">You were neon in a darkened room</p>
      <p class="lyric-line" data-time="23.3">Laughing like nothing could touch you</p>
      <p class="lyric-line" data-time="26.4">Every eye turned like they knew your name</p>
      <p class="lyric-line" data-time="31.2">But I was the one who stayed</p>
    </section>

    <section class="reveal" data-section="verse">
      <p class="lyric-line" data-time="35.1">You came home tasting like gin and smoke</p>
      <p class="lyric-line" data-time="40.4">City lights in your tangled coat</p>
      <p class="lyric-line" data-time="44.3">I tried to love you steady and slow</p>
      <p class="lyric-line" data-time="48.5">But you burned like summer on my throat</p>
    </section>

    <div class="divider"></div>

    <section class="reveal" data-section="prechorus">
      <div class="label">Pre-Chorus</div>
      <p class="lyric-line" data-time="53.6">You said you were done with the midnight spin</p>
      <p class="lyric-line" data-time="58.4">Done with drowning just to feel something</p>
      <p class="lyric-line" data-time="62.4">I wanted to believe you then</p>
      <p class="lyric-line" data-time="66.5">God, I wanted to believe</p>
    </section>

    <div class="divider"></div>

    <section class="reveal" data-section="chorus">
      <div class="label">Chorus</div>
      <p class="lyric-line" data-time="71.3">We were fire in a little house</p>
      <p class="lyric-line" data-time="74.5">Brooklyn walls couldn&rsquo;t hold us down</p>
      <p class="lyric-line" data-time="76.6">You were storm and I was ground</p>
      <p class="lyric-line" data-time="78.7">Trying to keep you safe</p>
    </section>

    <section class="reveal" data-section="chorus">
      <p class="lyric-line" data-time="80.9">You were wild but you were mine</p>
      <p class="lyric-line" data-time="83.0">And I was yours in the quiet times</p>
      <p class="lyric-line" data-time="85.3">If love&rsquo;s a line we walk half-blind</p>
      <p class="lyric-line" data-time="88.2">We were brave, weren&rsquo;t we?</p>
    </section>

    <div class="divider"></div>

    <section class="reveal" data-section="verse">
      <div class="label">Verse II</div>
      <p class="lyric-line" data-time="98.1">Bella sleeping by your side</p>
      <p class="lyric-line" data-time="101.1">Norm keeping watch like he always tried</p>
      <p class="lyric-line" data-time="106.6">Dogs don&rsquo;t ask where you&rsquo;ve been</p>
      <p class="lyric-line" data-time="110.1">They just love you when you walk back in</p>
    </section>

    <section class="reveal" data-section="verse">
      <p class="lyric-line" data-time="114.8">Suitcases leaning by the stairs</p>
      <p class="lyric-line" data-time="118.4">Maps and miles and borrowed air</p>
      <p class="lyric-line" data-time="123.4">Louisiana heat, Atlantic cold</p>
      <p class="lyric-line" data-time="127.3">We kept running but we never slowed</p>
    </section>

    <div class="divider"></div>

    <section class="reveal" data-section="prechorus">
      <div class="label">Pre-Chorus</div>
      <p class="lyric-line" data-time="133.1">You&rsquo;d raise your voice like thunder breaking</p>
      <p class="lyric-line" data-time="138.4">Then hold me like the sky was shaking</p>
    </section>

    <div class="divider"></div>

    <section class="reveal" data-section="chorus">
      <div class="label">Chorus</div>
      <p class="lyric-line" data-time="148.8">We were fire in a little house</p>
      <p class="lyric-line" data-time="150.8">Burning bright then burning out</p>
      <p class="lyric-line" data-time="153.0">You were storm and I was doubt</p>
      <p class="lyric-line" data-time="155.0">Trying to hold the line</p>
    </section>

    <section class="reveal" data-section="chorus">
      <p class="lyric-line" data-time="157.3">You were hurt and you were hope</p>
      <p class="lyric-line" data-time="159.4">And I tied my heart around your rope</p>
      <p class="lyric-line" data-time="161.7">If love&rsquo;s a tide that pulls and goes</p>
      <p class="lyric-line" data-time="164.5">We were deep, weren&rsquo;t we?</p>
    </section>

    <div class="divider"></div>

    <section class="reveal bridge" data-section="bridge">
      <div class="label">Bridge</div>
      <p class="lyric-line" data-time="174.0">Maybe you&rsquo;re sober now</p>
      <p class="lyric-line" data-time="176.7">Maybe I&rsquo;m older now</p>
      <p class="lyric-line" data-time="178.9">Maybe we both just needed space</p>
    </section>

    <section class="reveal bridge" data-section="bridge">
      <p class="lyric-line" data-time="182.5">Maybe the bar lights fade</p>
      <p class="lyric-line" data-time="185.7">Maybe the sharp words change</p>
      <p class="lyric-line" data-time="188.0">Maybe we meet again halfway</p>
    </section>

    <div class="divider"></div>

    <section class="reveal final" data-section="final">
      <div class="label">Final Chorus</div>
      <p class="lyric-line" data-time="196.2">We were weather, you and I</p>
      <p class="lyric-line" data-time="199.0">Blue sky turning violent skies</p>
      <p class="lyric-line" data-time="202.2">Still I see you in my mind</p>
      <p class="lyric-line" data-time="206.1">Soft and golden</p>
    </section>

    <section class="reveal final" data-section="final">
      <p class="lyric-line" data-time="209.5">If you knock on my door one night</p>
      <p class="lyric-line" data-time="212.8">With clear eyes and a steady light</p>
      <p class="lyric-line" data-time="214.8">I don&rsquo;t know if I&rsquo;d let you inside</p>
      <p class="lyric-line" data-time="217.8">But I&rsquo;d want to</p>
    </section>

    <div class="divider"></div>

    <section class="reveal outro" data-section="outro">
      <div class="label">Outro</div>
      <p class="lyric-line" data-time="222.0">Some loves don&rsquo;t end</p>
      <p class="lyric-line" data-time="226.1">Like summer turning into rain</p>
      <p class="lyric-line" data-time="231.1">And I still taste your name</p>
      <p class="lyric-line" data-time="237.1">When it storms</p>
    </section>

  </main>
</div>

<!-- love screen (full-page, fades in near song end) -->
<div class="love-screen" id="loveScreen">
  <div class="love-heart">
    <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="#ea3323"/></svg>
  </div>
  <p class="love-opener">I loved you in every weather.</p>
  <div class="love-body">
    <p>The wild kind.<br>The quiet kind.<br>The kind that doesn&rsquo;t have a name<br>but fills the whole sky.</p>
  </div>
  <div class="love-close">
    <p class="love-main">I love you so much.</p>
    <p class="love-author">&mdash; Oddur</p>
  </div>
</div>

<!-- player bar (floating pill) -->
<div class="player-bar" id="playerBar">
  <img class="bar-thumb" src="cover-680.jpg" alt="">
  <button class="ctrl-btn play-btn" aria-label="Play" id="playBtn">
    <svg id="iconPlay" viewBox="0 0 24 24"><path d="M8 5.14v13.72c0 .97 1.06 1.58 1.9 1.1l10.2-6.86c.8-.54.8-1.66 0-2.2L9.9 4.04C9.06 3.56 8 4.17 8 5.14z"/></svg>
    <svg id="iconPause" viewBox="0 0 24 24" style="display:none"><rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/></svg>
  </button>
  <div class="progress-group">
    <span class="time" id="curTime">0:00</span>
    <div class="progress-wrap" id="progressWrap">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <span class="time time-end" id="durTime">0:00</span>
  </div>
  <div class="volume-group">
    <button class="ctrl-btn vol-btn" id="volBtn" aria-label="Volume">
      <svg id="iconVolOn" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3A4.5 4.5 0 0 0 14 8.5v7c1.48-.73 2.5-2.25 2.5-3.5z"/></svg>
      <svg id="iconVolOff" viewBox="0 0 24 24" style="display:none"><path d="M3 9v6h4l5 5V4L7 9H3z"/></svg>
    </button>
    <input type="range" class="volume-slider" id="volSlider" min="0" max="1" step="0.01" value="1">
  </div>
  <button class="ctrl-btn replay-btn" aria-label="Replay" id="replayBtn">
    <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
  </button>
</div>

<script>
  // ======== AMBIENT CANVAS ========
  const canvas = document.getElementById('ambientCanvas');
  const ctx = canvas.getContext('2d');
  let W, H;

  function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  const orbs = [];
  for (let i = 0; i < 4; i++) {
    orbs.push({
      x: Math.random() * W,
      y: Math.random() * H,
      r: 180 + Math.random() * 220,
      vx: (Math.random() - .5) * .1,
      vy: (Math.random() - .5) * .08,
      hue: i % 2 === 0 ? 'rose' : 'blue',
      phase: Math.random() * Math.PI * 2
    });
  }

  let moodWarm = .5;
  let moodTarget = .5;
  let moodIntensity = .2;
  let moodIntensityTarget = .2;

  function drawAmbient(t) {
    ctx.clearRect(0, 0, W, H);

    moodWarm += (moodTarget - moodWarm) * .006;
    moodIntensity += (moodIntensityTarget - moodIntensity) * .008;

    for (const orb of orbs) {
      orb.x += orb.vx;
      orb.y += orb.vy;
      if (orb.x < -orb.r) orb.x = W + orb.r;
      if (orb.x > W + orb.r) orb.x = -orb.r;
      if (orb.y < -orb.r) orb.y = H + orb.r;
      if (orb.y > H + orb.r) orb.y = -orb.r;

      const pulse = 1 + Math.sin(t * .0006 + orb.phase) * .12;
      const r = orb.r * pulse;

      let alpha;
      if (orb.hue === 'rose') {
        alpha = (.02 + moodWarm * .03) * moodIntensity * 2;
      } else {
        alpha = (.02 + (1 - moodWarm) * .03) * moodIntensity * 2;
      }

      const grad = ctx.createRadialGradient(orb.x, orb.y, 0, orb.x, orb.y, r);
      if (orb.hue === 'rose') {
        grad.addColorStop(0, `rgba(181,112,110,${alpha})`);
      } else {
        grad.addColorStop(0, `rgba(106,138,158,${alpha})`);
      }
      grad.addColorStop(1, 'rgba(240,235,227,0)');

      ctx.fillStyle = grad;
      ctx.fillRect(orb.x - r, orb.y - r, r * 2, r * 2);
    }

    requestAnimationFrame(drawAmbient);
  }
  requestAnimationFrame(drawAmbient);

  // ======== AUDIO ========
  const audio = document.getElementById('audioEl');
  const playBtn = document.getElementById('playBtn');
  const playHero = document.getElementById('playHero');
  const iconPlay = document.getElementById('iconPlay');
  const iconPause = document.getElementById('iconPause');
  const progressBar = document.getElementById('progressBar');
  const progressWrap = document.getElementById('progressWrap');
  const curTime = document.getElementById('curTime');
  const durTime = document.getElementById('durTime');
  const replayBtn = document.getElementById('replayBtn');
  const lyricsPane = document.getElementById('lyricsPane');
  const volBtn = document.getElementById('volBtn');
  const volSlider = document.getElementById('volSlider');
  const iconVolOn = document.getElementById('iconVolOn');
  const iconVolOff = document.getElementById('iconVolOff');
  let savedVol = 1;
  const loveScreen = document.getElementById('loveScreen');

  function fmt(s) {
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return m + ':' + String(sec).padStart(2, '0');
  }

  audio.addEventListener('loadedmetadata', () => durTime.textContent = fmt(audio.duration));

  audio.addEventListener('timeupdate', () => {
    if (!audio.duration) return;
    progressBar.style.width = (audio.currentTime / audio.duration * 100) + '%';
    curTime.textContent = fmt(audio.currentTime);
    syncLyrics(audio.currentTime);

    // love screen: fade in near the end
    if (audio.currentTime >= 240 && !loveScreen.classList.contains('visible')) {
      loveScreen.classList.add('visible');
    }
  });

  audio.addEventListener('ended', () => {
    iconPlay.style.display = '';
    iconPause.style.display = 'none';
    // hold the love note for a few seconds before resetting
    setTimeout(() => {
      document.body.classList.remove('playing', 'synced');
      loveScreen.classList.remove('visible');
      lyricLines.forEach(el => el.classList.remove('lyric-active', 'lyric-near-1', 'lyric-near-2'));
      document.querySelectorAll('.label').forEach(el => el.classList.remove('label-active'));
      currentIdx = -1;
      syncActive = false;
      moodTarget = .5;
      moodIntensityTarget = .2;
      setTimeout(() => { lyricsPane.scrollTop = 0; }, 900);
    }, 4000);
  });

  function doPlay() {
    audio.play();
    iconPlay.style.display = 'none';
    iconPause.style.display = '';
    document.body.classList.add('playing');
    enterSyncMode();
  }

  function doPause() {
    audio.pause();
    iconPlay.style.display = '';
    iconPause.style.display = 'none';
  }

  playBtn.addEventListener('click', () => {
    if (audio.paused) doPlay();
    else doPause();
  });

  playHero.addEventListener('click', () => doPlay());

  function doReplay() {
    audio.currentTime = 0;
    currentIdx = -1;
    syncActive = false;
    loveScreen.classList.remove('visible');
    lyricLines.forEach(el => el.classList.remove('lyric-active', 'lyric-near-1', 'lyric-near-2'));
    document.querySelectorAll('.label').forEach(el => el.classList.remove('label-active'));
    lyricsPane.scrollTop = 0;
    doPlay();
  }

  replayBtn.addEventListener('click', doReplay);

  // ======== VOLUME ========
  volSlider.addEventListener('input', () => {
    audio.volume = volSlider.value;
    updateVolIcon();
  });

  volBtn.addEventListener('click', () => {
    if (audio.volume > 0) {
      savedVol = audio.volume;
      audio.volume = 0;
      volSlider.value = 0;
    } else {
      audio.volume = savedVol;
      volSlider.value = savedVol;
    }
    updateVolIcon();
  });

  function updateVolIcon() {
    if (audio.volume === 0) {
      iconVolOn.style.display = 'none';
      iconVolOff.style.display = '';
    } else {
      iconVolOn.style.display = '';
      iconVolOff.style.display = 'none';
    }
  }

  progressWrap.addEventListener('click', e => {
    const rect = progressWrap.getBoundingClientRect();
    const ratio = (e.clientX - rect.left) / rect.width;
    audio.currentTime = ratio * audio.duration;
    if (audio.paused) doPlay();
  });

  // ======== SYNCED LYRICS ========
  const lyricLines = Array.from(document.querySelectorAll('.lyric-line'));
  const lyricTimes = lyricLines.map(el => parseFloat(el.dataset.time));
  let currentIdx = -1;
  let syncActive = false;

  const sectionMoods = {
    verse:     { warm: .65, intensity: .3 },
    prechorus: { warm: .55, intensity: .4 },
    chorus:    { warm: .4,  intensity: .6 },
    bridge:    { warm: .3,  intensity: .45 },
    final:     { warm: .45, intensity: .7 },
    outro:     { warm: .6,  intensity: .2 }
  };

  function enterSyncMode() {
    if (syncActive) return;
    syncActive = true;
    document.body.classList.add('synced');
    document.querySelectorAll('.reveal').forEach(el => el.classList.add('visible'));
  }

  function syncLyrics(time) {
    if (!syncActive) return;

    let idx = -1;
    for (let i = lyricTimes.length - 1; i >= 0; i--) {
      if (time >= lyricTimes[i]) { idx = i; break; }
    }

    if (idx === currentIdx) return;
    currentIdx = idx;

    lyricLines.forEach(el => el.classList.remove('lyric-active', 'lyric-near-1', 'lyric-near-2'));
    document.querySelectorAll('.label').forEach(el => el.classList.remove('label-active'));

    if (idx < 0) return;

    lyricLines[idx].classList.add('lyric-active');
    if (idx - 1 >= 0) lyricLines[idx - 1].classList.add('lyric-near-1');
    if (idx + 1 < lyricLines.length) lyricLines[idx + 1].classList.add('lyric-near-1');
    if (idx - 2 >= 0) lyricLines[idx - 2].classList.add('lyric-near-2');
    if (idx + 2 < lyricLines.length) lyricLines[idx + 2].classList.add('lyric-near-2');

    const section = lyricLines[idx].closest('section');
    const label = section && section.querySelector('.label');
    if (label) label.classList.add('label-active');

    const sectionType = section && section.dataset.section;
    if (sectionType && sectionMoods[sectionType]) {
      moodTarget = sectionMoods[sectionType].warm;
      moodIntensityTarget = sectionMoods[sectionType].intensity;
    }

    const paneRect = lyricsPane.getBoundingClientRect();
    const lineRect = lyricLines[idx].getBoundingClientRect();
    const offset = lineRect.top - paneRect.top - paneRect.height / 2 + lineRect.height / 2;
    lyricsPane.scrollBy({ top: offset, behavior: 'smooth' });
  }

  // ======== LYRIC LINE CLICKS ========
  lyricLines.forEach((el, i) => {
    el.addEventListener('click', () => {
      // click pulse
      el.classList.remove('lyric-click');
      void el.offsetWidth;
      el.classList.add('lyric-click');

      audio.currentTime = lyricTimes[i];
      if (audio.paused) doPlay();
      else enterSyncMode();
    });
    el.addEventListener('animationend', () => el.classList.remove('lyric-click'));
  });

  // ======== REVEAL OBSERVER ========
  const obs = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
  }, { root: lyricsPane, threshold: 0.15 });
  document.querySelectorAll('.reveal').forEach(el => obs.observe(el));

  // ======== PASSWORD GATE ========
  const gate = document.getElementById('gate');
  const gateInput = document.getElementById('gateInput');

  gateInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      if (gateInput.value.toLowerCase() === 'bloop') {
        gate.classList.add('unlocked');
        gate.addEventListener('transitionend', () => gate.remove());
      } else {
        gateInput.classList.add('gate-wrong');
        gateInput.addEventListener('animationend', () => gateInput.classList.remove('gate-wrong'), { once: true });
        gateInput.value = '';
      }
    }
  });

  // ======== KEYBOARD ========
  document.addEventListener('keydown', e => {
    if (e.target.tagName === 'INPUT') return;
    if (e.code === 'Space') {
      e.preventDefault();
      if (audio.paused) doPlay();
      else doPause();
    }
  });
</script>

</body>
</html>
